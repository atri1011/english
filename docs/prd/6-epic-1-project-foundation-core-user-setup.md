# 6. 史诗 1: 项目基础与核心用户设置 (Project Foundation & Core User Setup)

**扩展目标:** 此史诗旨在构建应用的完整技术骨架和面向用户的核心设置流程。在完成此史诗后，我们将拥有一个可部署、安全的应用外壳。用户将能够创建账户、登录，并安全地管理其个人API配置，为下一阶段的核心学习功能做好万全准备。

## 故事 1.1: 项目初始化与部署设置
* **作为一个** 项目所有者, **我想要** 一个初始化好的 Next.js Monorepo 项目，并将其配置好在 Vercel 上进行自动化部署, **以便于** 我们拥有一个稳固的、具备持续集成/持续部署（CI/CD）能力的技术基础和一个可供后续开发的实时网址。
* **验收标准:**
    1.  一个新的 Monorepo 仓库已创建，其中包含一个使用 Next.js 和 TypeScript 的 Web 应用包。
    2.  项目已连接到一个 Git 仓库（如 GitHub）。
    3.  一个基础的欢迎页面或应用入口已成功部署到一个 Vercel 的公开 URL 上。
    4.  Vercel 部署流程已配置为在代码推送到主分支时自动触发。

## 故事 1.2: 用户数据模式与数据库设置
* **作为一个** 开发者, **我想要** 建立 Supabase 项目并为用户及他们加密后的API配置定义好数据库模式, **以便于** 我们有一个安全、可靠的基础来存储所有用户数据。
* **验收标准:**
    1.  一个新的 Supabase 项目已创建并与 Vercel 项目连接。
    2.  `users` 表已创建，并与 Supabase 的认证（Auth）服务集成。
    3.  一个独立的 `user_api_configs` 表已创建，包含 `user_id`（关联用户）、`api_url`、`encrypted_api_key` 和 `model_name` 等字段。
    4.  `encrypted_api_key` 字段绝不能以明文形式存储 API 密钥。
    5.  数据库已启用行级安全（RLS）策略，确保用户只能访问和修改自己的 API 配置。

## 故事 1.3: 用户注册功能
* **作为一个** 新访客, **我想要** 使用我的邮箱和密码注册一个新账户, **以便于** 我可以开始使用这个应用。
* **验收标准:**
    1.  应用提供一个包含邮箱和密码输入框的注册表单。
    2.  成功提交后，将在 Supabase Auth 中创建一个新用户。
    3.  用户在注册后会自动登录，并被重定向到应用主页。
    4.  当输入的邮箱格式无效或该邮箱已被注册时，会向用户显示清晰的错误提示。

## 故事 1.4: 用户登录与会话管理
* **作为一个** 已注册用户, **我想要** 使用我的邮箱和密码登录，并在不同浏览器会话中保持登录状态, **以便于** 我可以方便、安全地访问我的账户。
* **验收标准:**
    1.  应用提供一个包含邮箱和密码输入框的登录表单。
    2.  成功登录后，用户被重定向到应用主页。
    3.  应用能够通过会话（Session）机制，在用户关闭并重新打开浏览器后保持其登录状态。
    4.  应用提供一个功能明确的“退出登录”按钮，点击后能清除用户的会话。
    5.  当输入的凭证不正确时，会向用户显示清晰的错误提示。

## 故事 1.5: API 配置页面
* **作为一个** 已登录用户, **我想要** 一个专属的设置页面，用来输入、查看和更新我的 AI 服务 API URL、API 密钥和模型名称, **以便于** 我可以将应用连接到我自己的 AI 服务。
* **验收标准:**
    1.  应用中有一个“API 设置”页面，且此页面仅对已登录用户可见。
    2.  页面包含用于输入 API URL、API 密钥（输入时应被遮蔽）和模型名称的表单字段。
    3.  如果用户已有配置，再次进入此页面时，表单会预先填入已保存的 API URL 和模型名称（API 密钥不应被明文显示）。
    4.  页面上有一个功能明确的“保存”按钮。
    5.  页面上有清晰的文字说明，解释每个字段的用途和如何获取这些信息。

## 故事 1.6: 安全保存 API 配置
* **作为一个** 已登录用户, **我想要** 在我保存 API 配置时，系统能够安全地加密并存储我的 API 密钥, **以便于** 保护我的凭证信息不被泄露。
* **验收标准:**
    1.  用户点击“保存”时，表单数据会被发送到一个安全的后端 Serverless Function。
    2.  该后端功能在将 API 密钥存入数据库前，必须对其进行加密处理。
    3.  API 密钥在数据库的任何地方都绝不能以明文形式存储。
    4.  API URL 和模型名称与加密后的密钥一同被保存或更新。
    5.  保存成功后，前端界面会给用户一个明确的成功提示。
    6.  后端功能必须验证操作者身份，确保用户只能修改自己的配置。

---