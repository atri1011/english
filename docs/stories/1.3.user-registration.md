# 故事 1.3: 用户注册功能

## Status
Done

## Story
**作为一个** 新访客, 
**我想要** 使用我的邮箱和密码注册一个新账户, 
**以便于** 我可以开始使用这个应用。

## Acceptance Criteria
1.  应用提供一个包含邮箱和密码输入框的注册表单。
2.  成功提交后，将在 Supabase Auth 中创建一个新用户。
3.  用户在注册后会自动登录，并被重定向到应用主页。
4.  当输入的邮箱格式无效或该邮箱已被注册时，会向用户显示清晰的错误提示。

## Tasks / Subtasks
- [x] Task 1: 创建注册页面UI (AC: 1)
    - [x] 在 `apps/web/app/(auth)/register/page.tsx` 创建注册页面。 [参考: `architecture/8-unified-project-structure.md`]
    - [x] 使用 Shadcn/ui 组件构建一个包含邮箱、密码输入框和提交按钮的表单。 [参考: `architecture/3-tech-stack.md`]
- [x] Task 2: 实现注册逻辑 (AC: 2, 3)
    - [x] 创建一个 Supabase 客户端实例。 [参考: `architecture/8-unified-project-structure.md`]
    - [x] 在表单提交时，调用 Supabase Auth 的 `signUp` 方法。 [参考: `architecture/3-tech-stack.md`]
    - [x] 成功注册后，将用户重定向到主页 (`/`)。
- [x] Task 3: 实现错误处理 (AC: 4)
    - [x] 捕获 `signUp` 方法可能抛出的错误。
    - [x] 根据错误类型，向用户显示相应的错误信息（例如，“邮箱已被占用”或“无效的邮箱地址”）。
- [x] Task 4: 添加测试 (AC: All)
    - [x] 为注册表单组件编写单元/集成测试，验证其渲染和用户交互。 [参考: `architecture/10-testing-strategy.md`]
    - [ ] (可选) 编写一个 Playwright E2E 测试，模拟完整的用户注册流程。 [参考: `architecture/10-testing-strategy.md`]

## Dev Notes

### Previous Story Insights
故事 1.2 `(1.2.user-data-schema-and-database-setup.md)` 建立了数据库模式，但没有实现任何用户交互功能。此故事是第一个实现核心用户认证流程的故事。

### 认证技术
[Source: `architecture/3-tech-stack.md`]
- **认证服务**: Supabase Auth。将使用 Supabase 客户端库 (`@supabase/supabase-js`) 直接与 Supabase Auth 交互。

### 数据模型
[Source: `architecture/4-data-models.md`]
- 此故事将与由 Supabase Auth 自动管理的 `User` 模型进行交互。无需直接操作数据库表。

### 项目结构注意事项
[Source: `architecture/8-unified-project-structure.md`]
- 注册页面必须创建在 `apps/web/app/(auth)/register/` 目录下。
- 任何与 Supabase 客户端相关的配置代码应放在 `apps/web/lib/supabase/` 中。

### 测试要求
[Source: `architecture/10-testing-strategy.md`]
- 必须为注册表单组件 (`apps/web/app/(auth)/register/page.tsx`) 提供单元/组件测试。
- 测试应覆盖表单的成功提交、用户输入验证以及错误信息的显示。

### 技术约束
- 必须使用 Supabase Auth 提供的 `signUp` 功能来处理用户注册，以确保与 Supabase 的安全策略（如邮件确认）保持一致。
- 不得在客户端代码中硬编码任何敏感信息（如 Supabase `service_role` key）。所有与 Supabase 的交互都应通过公共的 `anon` key 进行。

## Dev Agent Record

### File List
- **Created**: `apps/web/app/(auth)/register/page.tsx`
- **Created**: `apps/web/lib/supabase/client.ts`
- **Created**: `apps/web/app/(auth)/register/page.test.tsx`
- **Created**: `apps/web/src/components/ui/button.tsx`
- **Created**: `apps/web/src/components/ui/card.tsx`
- **Created**: `apps/web/src/components/ui/input.tsx`
- **Created**: `apps/web/src/components/ui/label.tsx`
- **Modified**: `apps/web/package.json`
- **Modified**: `apps/web/tailwind.config.js`
- **Modified**: `apps/web/app/globals.css`
- **Modified**: `apps/web/components.json`